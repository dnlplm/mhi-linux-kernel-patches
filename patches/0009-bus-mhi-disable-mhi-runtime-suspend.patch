From c119279b4058188544567db51f2f30a26e3487ef Mon Sep 17 00:00:00 2001
From: Carlo Lobrano <carlo.lobrano@telit.com>
Date: Thu, 3 Feb 2022 14:16:00 +0100
Subject: [PATCH 9/9] bus: mhi: disable mhi runtime suspend

This patch disables runtime suspends, since it  prevents the detection
of modem rebooting in specific scenarios (e.g. sahara coredump).

Signed-off-by: Daniele Palmas <dnlplm@gmail.com>
---
 drivers/bus/mhi/pci_generic.c | 8 --------
 1 file changed, 8 deletions(-)

diff --git a/drivers/bus/mhi/pci_generic.c b/drivers/bus/mhi/pci_generic.c
index e3045f4d354e..ce137558fa39 100644
--- a/drivers/bus/mhi/pci_generic.c
+++ b/drivers/bus/mhi/pci_generic.c
@@ -878,14 +878,6 @@ static int mhi_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 	/* start health check */
 	mod_timer(&mhi_pdev->health_check_timer, jiffies + HEALTH_CHECK_PERIOD);
 
-	/* Only allow runtime-suspend if PME capable (for wakeup) */
-	if (pci_pme_capable(pdev, PCI_D3hot)) {
-		pm_runtime_set_autosuspend_delay(&pdev->dev, 2000);
-		pm_runtime_use_autosuspend(&pdev->dev);
-		pm_runtime_mark_last_busy(&pdev->dev);
-		pm_runtime_put_noidle(&pdev->dev);
-	}
-
 	return 0;
 
 err_unprepare:
-- 
2.25.1

